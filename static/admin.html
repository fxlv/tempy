<html>
	<head>
		<title>Tempy!</title>
		<link rel="stylesheet" href="/style.css" />
	</head>
	<script type="text/javascript" src="http://yotta.tln/js/jquery.js"></script>
		<script type="text/javascript">
			console.log("Javascript started executing "+new Date());
			
								
								
			// get the list of available sensors
			// then for each sensor fire a callback to populate the #sensors list
			function show_sensors(){
			console.log("show_sensors() called "+new Date());
			var temperature_callbacks = $.Callbacks();
			temperature_callbacks.add(get_temperature);
				
				$.get("http://tempy.tln/sensors", function(data){
						console.log("Callback code executing, Got data from api "+new Date());
						var sensors = "<ul id=\"sensors_list\"></ul>";
						for ( sensor in data.sensors_list){
							var sensor_temp = "not yet here";
							temperature_callbacks.fire(data.sensors_list[sensor]);
						}
						$("#sensors").html(sensors);
						console.log("Ul has been drawn "+new Date());

						console.log("Callback code finished executing "+new Date());
					});
				console.log("show_sensors() ended "+new Date());
			}
			
			var get_temperature = function(test_value){
				console.log("get_temperature() started "+new Date());

				$.get("http://tempy.tln/get/"+test_value+"/last", function(sensor_temp){
							console.log("/get/ -> Callback for "+sensor_temp.sensor);
							console.log(sensor_temp.temperature);
							console.log(sensor_temp.source);
							$("ul#sensors_list").append("<li><div class='temperature'>"+sensor_temp.temperature+"</div>"+sensor_temp.sensor+"</li>");
							});
				console.log("get_temperature() ended "+new Date());
			}	
			function item_count(){
					$("#count").show();
					$("#count").html("getting item count, please stand by...");
					$.get("http://tempy.tln/count", function(data){
						item_count = "Current item count:"+data.item_count;
						$("#count").html(item_count);

					});
				
				//$("#show").click(function(){
				//	$(".this").show();
				//});
			}				
			$(document).ready(function(){
				console.log("document ready callback started "+new Date());
				//defaults
				$("#count").hide();
				//$(".this").html("Whoa, this got changed by javascript");
				$("#get_count_button").click(function(){
					item_count();
				});
				$("#get_sensors_button").click(function(){
					console.log("get_sensors_button callback started "+new Date());
					$("#sensors").html("getting sensors list, please stand by...");
					show_sensors();
					console.log("get_sensors_button callback ended "+new Date());
					
			});
			console.log("document ready callback ended "+new Date());
			});
			console.log("End of javascript"+new Date());
		</script>
	<body>
		
		<h1>Welcome to Tempy!</h1>
		
		<div id="data">
			<div id="count">Current item count: unknown</div>
			<div id="sensors">Available sensors: unknown</div>
		</div>
		<div id="hujnja"></div>
		<div id="buttons">
			<button id="get_count_button">Get count</button>
			<button id="get_sensors_button">Get sensors</button>
		</div>
		
	</body>
</html>